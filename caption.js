class Caption{
    constructor({data}){
        this.data = data;
        this.wrapper = undefined;

        let stylesheet = document.createElement("style");
        stylesheet.innerHTML = `
            .editor-caption, .editor-caption-title{                
                font-weight: bold;
                min-width: 10rem;
            }

            .editor-caption-title{
                color: #B22222;
            }

            .editor-caption-title::after{
                content: "##.";
                margin-right: 0.5rem;
                margin-left: 0.5rem;
                padding: 0;
            }

            .editor-caption-wrapper{
                display: block;
                padding-top: 0.5rem;
            }

            .editor-caption, .editor-caption-title, .editor-caption:active, .editor-caption-title:active{
                border: none;
                border-image-width: 0;
                background-color: none;
            }
        `;
        document.getElementsByTagName("head")[0].appendChild(stylesheet);
    }

    static get toolbox(){
        return {
            title: "Caption",
            icon: `<?xml version="1.0" encoding="UTF-8" standalone="no"?>
            <!-- Created with Inkscape (http://www.inkscape.org/) -->
            
            <svg
               width="17"
               height="18"
               viewBox="0 0 44.979164 47.625001"                              
               xmlns="http://www.w3.org/2000/svg"
               xmlns:svg="http://www.w3.org/2000/svg">
               <g>      
                <path
                   style="fill:none;stroke:#000000;stroke-width:2.565;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                   d="m 22.551051,40.796402 -6.834149,-8.195185 c 0,0 -0.268005,-0.806082 -2.278049,-0.806082 -2.010044,0 -9.045197,0.134348 -9.045197,0.134348 0,0 -1.6750362,0 -1.6750362,-2.149557 V 13.070134 c 0,0 -0.3281798,-2.645137 2.6397126,-2.645137 H 39.911272 c 0,0 2.455458,-0.194177 2.455458,2.460411 v 16.760171 c 0,0 0.33501,2.275505 -2.269674,2.275505 H 30.85923 c 0,0 -0.801649,-0.238185 -1.774353,1.027057 -0.972704,1.265244 -6.533826,7.848261 -6.533826,7.848261 z"
                   id="path1331"
                   sodipodi:nodetypes="ccscscscscscsc" />
                <g><g>
                    <path
                       d="m 19.666295,17.425868 q 0,-0.124178 0.09031,-0.214489 0.09031,-0.09031 0.214489,-0.09031 h 0.417689 q 0.124178,0 0.214489,0.09031 0.09031,0.09031 0.09031,0.214489 v 7.405518 q 0,0.124178 -0.09031,0.214489 -0.09031,0.09031 -0.214489,0.09031 h -0.417689 q -0.124178,0 -0.214489,-0.09031 -0.09031,-0.09031 -0.09031,-0.214489 V 24.48143 q -0.575734,0.767646 -1.74978,0.767646 -0.699912,0 -1.275646,-0.327379 -0.564445,-0.327378 -0.914401,-0.936978 -0.338667,-0.609601 -0.372533,-1.422402 l -0.01129,-0.372533 0.01129,-0.361245 q 0.03387,-0.812801 0.372533,-1.411113 0.349956,-0.6096 0.914401,-0.936978 0.564445,-0.327379 1.275646,-0.327379 0.632179,0 1.061157,0.225778 0.440267,0.21449 0.688623,0.541868 z m 0,4.368804 q -0.03387,-0.790223 -0.474134,-1.23049 -0.440267,-0.440267 -1.162757,-0.440267 -0.733778,0 -1.174045,0.474134 -0.428979,0.474133 -0.474134,1.286934 l -0.01129,0.31609 0.01129,0.316089 q 0.04516,0.812801 0.474134,1.286934 0.440267,0.474134 1.174045,0.474134 0.699912,0 1.151468,-0.428978 0.451556,-0.440267 0.485423,-1.162757 0.01129,-0.112889 0.01129,-0.451556 0,-0.327378 -0.01129,-0.440267 z"
                       id="path828" />
                    <path
                       d="m 24.70114,19.153069 q 1.207912,0 1.907824,0.767646 0.699912,0.767645 0.699912,2.088446 v 0.304801 q 0,0.124177 -0.09031,0.214489 -0.09031,0.09031 -0.214489,0.09031 h -3.883382 v 0.06773 q 0.02258,0.745068 0.451557,1.174046 0.440267,0.417689 1.12889,0.417689 0.564445,0 0.869245,-0.146756 0.316089,-0.146755 0.564445,-0.417689 0.09031,-0.09031 0.158044,-0.124178 0.07902,-0.03387 0.203201,-0.03387 h 0.338667 q 0.135467,0 0.225778,0.09031 0.09031,0.09031 0.07902,0.214489 -0.04516,0.3048 -0.338667,0.632178 -0.282222,0.316089 -0.82409,0.541867 -0.530578,0.21449 -1.275645,0.21449 -0.72249,0 -1.286935,-0.327379 -0.564445,-0.338667 -0.903112,-0.925689 -0.327378,-0.587023 -0.395112,-1.320802 -0.02258,-0.338667 -0.02258,-0.519289 0,-0.180623 0.02258,-0.51929 0.06773,-0.699911 0.395112,-1.264356 0.338667,-0.564445 0.891823,-0.891823 0.564445,-0.327379 1.298224,-0.327379 z m 1.591734,2.517425 v -0.03387 q 0,-0.688622 -0.440267,-1.095023 -0.428978,-0.417689 -1.151467,-0.417689 -0.654757,0 -1.117602,0.417689 -0.451556,0.417689 -0.462845,1.095023 v 0.03387 z"
                       id="path830" />
                    <path
                       d="m 30.085936,22.528451 q -1.64818,-0.349956 -1.64818,-1.682047 0,-0.462844 0.248356,-0.846667 0.248356,-0.383823 0.733778,-0.609601 0.496712,-0.237067 1.207913,-0.237067 0.699912,0 1.207912,0.203201 0.508001,0.2032 0.767645,0.508 0.270934,0.3048 0.270934,0.587023 0,0.112889 -0.09031,0.2032 -0.09031,0.07902 -0.214489,0.07902 H 32.19696 q -0.214489,0 -0.338667,-0.158044 -0.349956,-0.451556 -1.23049,-0.451556 -0.51929,0 -0.846668,0.191911 -0.316089,0.191911 -0.316089,0.530578 0,0.282223 0.158045,0.428979 0.158044,0.146755 0.474133,0.237067 0.31609,0.09031 1.117602,0.270933 0.993423,0.214489 1.411112,0.654756 0.417689,0.440268 0.417689,1.072446 0,0.462845 -0.293511,0.857956 -0.282222,0.395112 -0.82409,0.643468 -0.530578,0.237067 -1.241779,0.237067 -0.699912,0 -1.241779,-0.21449 -0.530578,-0.225778 -0.824089,-0.541867 -0.293512,-0.316089 -0.293512,-0.598311 0,-0.112889 0.09031,-0.191912 0.09031,-0.09031 0.214489,-0.09031 h 0.406401 q 0.1016,0 0.180622,0.02258 0.07902,0.02258 0.146756,0.124178 0.372534,0.519289 1.320801,0.519289 0.530579,0 0.92569,-0.214489 0.406401,-0.225778 0.406401,-0.553156 0,-0.270934 -0.203201,-0.428978 -0.191911,-0.169334 -0.564445,-0.270934 -0.372533,-0.112889 -1.162756,-0.282222 z"
                       id="path832" />
                    <path
                       d="m 36.75766,24.27823 q 1.12889,0 1.524001,-0.880534 0.07902,-0.169334 0.158045,-0.237067 0.07902,-0.06773 0.214489,-0.06773 h 0.338667 q 0.124178,0 0.214489,0.09031 0.09031,0.07902 0.09031,0.191911 0,0.383823 -0.3048,0.82409 -0.3048,0.440267 -0.880534,0.745067 -0.575734,0.304801 -1.354668,0.304801 -0.801512,0 -1.388535,-0.338667 -0.587023,-0.338667 -0.903112,-0.92569 -0.316089,-0.598312 -0.349956,-1.33209 -0.01129,-0.135467 -0.01129,-0.51929 0,-0.270934 0.01129,-0.383823 0.1016,-1.151467 0.778934,-1.873957 0.677334,-0.72249 1.862669,-0.72249 0.778934,0 1.343379,0.304801 0.575734,0.293511 0.869245,0.733778 0.304801,0.428978 0.327378,0.812801 0.01129,0.124178 -0.09031,0.214489 -0.09031,0.09031 -0.214489,0.09031 h -0.338667 q -0.135467,0 -0.214489,-0.06773 -0.07902,-0.06773 -0.158045,-0.237067 -0.395111,-0.880534 -1.524001,-0.880534 -0.62089,0 -1.083735,0.417689 -0.462844,0.417689 -0.530578,1.264357 -0.01129,0.124178 -0.01129,0.4064 0,0.259645 0.01129,0.383823 0.07902,0.846668 0.530578,1.264357 0.462845,0.417689 1.083735,0.417689 z"
                       id="path834" />
                  </g>
                  <g>
                    <path
                       d="m 13.615333,18.909527 q 0.155222,0 0.268111,0.112889 0.112888,0.112888 0.112888,0.26811 v 0.451556 q 0,0.155222 -0.112888,0.268111 -0.112889,0.112888 -0.268111,0.112888 h -1.41111 l -0.352778,2.370665 h 1.396999 q 0.155222,0 0.268111,0.112889 0.112889,0.112889 0.112889,0.268111 v 0.451555 q 0,0.155222 -0.112889,0.268111 -0.112889,0.112889 -0.268111,0.112889 H 11.668001 L 11.428112,25.3583 q -0.02822,0.126999 -0.127,0.211666 -0.08467,0.08467 -0.225777,0.08467 h -0.606778 q -0.127,0 -0.225777,-0.08467 -0.08467,-0.09878 -0.08467,-0.225778 v -0.02822 l 0.239889,-1.608665 H 8.4647811 L 8.2248924,25.3583 q -0.028222,0.126999 -0.1269999,0.211666 -0.084667,0.08467 -0.2257776,0.08467 H 7.2653376 q -0.1269999,0 -0.2257776,-0.08467 -0.084667,-0.09878 -0.084667,-0.225778 v -0.02822 L 7.1947821,23.707301 H 5.9530053 q -0.1552221,0 -0.2681109,-0.112889 -0.1128888,-0.112889 -0.1128888,-0.268111 v -0.451555 q 0,-0.155222 0.1128888,-0.268111 0.1128888,-0.112889 0.2681109,-0.112889 h 1.4252211 l 0.3527775,-2.370665 h -1.41111 q -0.1552221,0 -0.2681109,-0.112888 -0.1128888,-0.112889 -0.1128888,-0.268111 v -0.451556 q 0,-0.155222 0.1128888,-0.26811 0.1128888,-0.112889 0.2681109,-0.112889 H 7.9144482 L 8.168448,17.258528 q 0.028222,-0.127 0.1128888,-0.211666 0.098778,-0.08467 0.2257776,-0.08467 h 0.6067773 q 0.1269999,0 0.2116665,0.09878 0.098778,0.08467 0.098778,0.211666 v 0.04233 l -0.2398887,1.594555 h 1.9332208 l 0.254,-1.650999 q 0.02822,-0.127 0.112889,-0.211666 0.09878,-0.08467 0.225777,-0.08467 h 0.606777 q 0.127,0 0.211667,0.09878 0.09878,0.08467 0.09878,0.211666 v 0.04233 l -0.239889,1.594555 z m -3.033887,3.584219 0.352778,-2.370665 H 9.0010029 l -0.3527775,2.370665 z"
                       style="font-size:14.1111px"
                       id="path837" />
                  </g>
                </g>
              </g>
            </svg>
            `
        };
    }

    render(){
        let wrapper = document.createElement('div');
        wrapper.classList.add('editor-caption-wrapper');
        let title = document.createElement('span');
        title.contentEditable = true;
        title.classList.add("editor-caption-title");
        let caption = document.createElement('span');
        caption.contentEditable = true;
        caption.classList.add("editor-caption");

        wrapper.appendChild(title);
        wrapper.appendChild(caption);

        title.innerText = this.data && this.data.title ? this.data.title : "Title";
        caption.innerHTML = this.data && this.data.caption ? this.data.caption : "Caption here";

        return wrapper;
    }

    save(blockContent){
        let title = blockContent.querySelector('.editor-caption-title').innerText;
        let caption = blockContent.querySelector(".editor-caption").innerHTML;

        return {
            title: title,
            caption: caption
        };
    }
}